# X-Ray AI分析可视化页面 - 产品需求文档 (PRD)

> **版本:** 1.0
> **日期:** 2025-11-22
> **负责人:** Cascade

---

## 1. 概述

### 1.1. 项目目标

为全景片和侧位片的AI模型推理结果提供一个专业、高效、直观的前端可视化界面。该界面旨在帮助专业医生快速验证AI分析结果，并获取结构化的诊断报告。

### 1.2. 目标用户

**资深正畸/口腔医生 (A类用户)**
- **特点:** 专业知识扎实，注重数据精确性与验证效率。
- **核心诉求:** 快速验证AI标记的准确性，并高效获取可用于临床决策或病历撰写的结构化数据报告。

### 1.3. 设计原则

- **简约高效:** 界面设计简洁，避免不必要的功能干扰，聚焦核心价值。
- **重点突出:** 视觉上突出异常和关键发现，帮助医生快速定位问题。
- **精准呈现:** 确保AI分析结果（点、线、框、数据）在界面上得到准确无误的展示。

---

## 2. 页面整体布局

采用经典的 **双栏布局**：

- **左侧 (主区域):** **图像查看区**，用于展示X光片及AI标记。
- **右侧 (侧边栏):** **AI分析报告区**，用于展示结构化的分析数据和结论。

```
+-------------------------------------+--------------------------+
|                                     |                          |
|                                     |     AI 分析报告区        |
|                                     |    (可滚动)              |
|           图像查看区                |                          |
|       (X-Ray Image + Overlays)      |    - 摘要                |
|                                     |    - 骨骼分析            |
|                                     |    - 牙齿分析            |
|                                     |    - ...                 |
|                                     |                          |
+-------------------------------------+--------------------------+
```

---

## 3. 图像查看区 (左栏)

此区域负责加载用户上传的X光片，并在其上叠加AI分析的标记。

### 3.1. 侧位片 (Cephalometric) 视图

- **关键点标记:**
    - 在图像上精确绘制所有`Landmarks`数组中的关键点。
    - 每个点旁边显示其缩写标签 (`Label`字段，如 "S", "N", "Ba")。
    - 对于`Status`为 "Missing" 的点，应使用不同的颜色或样式（如灰色、空心圆）进行标记，以示区别。
- **交互效果:**
    - 当鼠标**悬停**在任何一个关键点上时，显示一个浮动提示框 (Tooltip)，内容包含：
        - **全名:** (需要一个从缩写到全名的映射表，如 S: 蝶鞍点)。
        - **坐标:** (X, Y)。
        - **置信度:** `Confidence`字段值。
- **禁止项:** 不需要在图像上绘制任何测量线或角度。

### 3.2. 全景片 (Panoramic) 视图

- **标记样式:** 使用不同颜色和样式的边框或半透明填充来区分不同的诊断发现。建议如下：
    - **龋坏 (`carious_lesion`):** 红色半透明填充。
    - **种植体 (`implant`):** 蓝色边框。
    - **根尖密度影 (`density_low`/`density_high`):** 黄色虚线边框。
    - **牙齿分割区域 (`SegmentationMask`):** 绿色轮廓。
    - **其他发现 (如残根、修复牙等):** 可使用不同颜色的轮廓线。
- **交互效果:**
    - 当鼠标**悬停**在任何一个标记区域上时，显示一个浮动提示框，内容为该发现的详细描述 (`Description` 或 `Detail` 字段)。

---

## 4. AI分析报告区 (右侧)

此区域以结构化、易于阅读的方式展示AI分析的所有数据和结论。

### 4.1. 报告结构

报告内容需按照临床逻辑进行分组，而不是直接按JSON结构展示。

- **侧位片报告结构:**
    1.  **分析摘要:** `VisibilityMetrics`, `StatisticalFields` (可见性、质量评分等)。
    2.  **骨骼分析:** 包含评估上下颌骨关系、生长型等的测量项 (如 ANB角, 面部高度比, 下颌平面角等)。
    3.  **牙齿分析:** 包含评估牙齿倾斜度、位置的测量项 (如 UI-SN角, IMPA等)。
    4.  **生长发育评估:** 颈椎成熟度分期 (`Cervical_Vertebral_Maturity_Stage`)等。
    5.  **气道分析:** `Airway_Gap`, `Adenoid_Index`。
    6.  **完整数据列表:** (可选)提供一个可展开的区域，展示所有原始测量数据。

- **全景片报告结构:**
    1.  **整体诊断摘要:** 汇总关键发现，如颌骨对称性、牙周状况、智齿问题等。
    2.  **颌骨与关节:** `JointAndMandible`, `MaxillarySinus` 的诊断结果。
    3.  **牙周与缺牙:** `PeriodontalCondition`, `MissingTeeth` 的结果。
    4.  **智齿分析:** `ThirdMolarSummary` 的详细情况。
    5.  **特殊发现:** `ImplantAnalysis`, `RootTipDensityAnalysis` 的结果。
    6.  **单牙诊断详情:** 以列表形式展示 `ToothAnalysis` 中每一颗牙齿的详细问题。

### 4.2. 数据展示格式

- **数值与解读并列:** 将测量值和AI给出的诊断结论并排展示，方便快速解读。
    - **示例:** `ANB角: 3.5° (骨性I类)`
- **突出异常:** 对被判定为异常 (`Level`不为0或正常状态) 的项目进行视觉强调。
    - **实现方式:** 可以使用不同颜色的文本（如红色）、背景色或在旁边添加醒目的图标（如 ⚠️）。
- **特殊数据展示:**
    - 对于颈椎成熟度 (`CVSM`) 的Base64图片，应直接在报告中渲染成可见的图像。

---

## 5. 失败/错误处理

当接收到 `status: "FAILURE"` 的JSON时，页面应作如下处理：

- **图像查看区:** 显示占位符或提示信息，表明无法加载图像。
- **AI分析报告区:** 清空所有报告模块，仅在最上方显示一个醒目的错误提示框，内容为 `error.displayMessage` 字段的值（如：“图像质量过低，无法进行分析”）。

