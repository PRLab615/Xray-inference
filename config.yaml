# 全局配置文件
# 支持环境变量覆盖：REDIS_HOST, REDIS_PORT, REDIS_DB, REDIS_PASSWORD

# Redis 配置
redis:
  host: "localhost"  # Docker: 使用 "redis"
  port: 9006
  db: 0
  password: null

# Celery 配置
celery:
  broker_url: "redis://localhost:9006/0"
  result_backend: "redis://localhost:9006/1"

# API 配置
api:
  host: "0.0.0.0"
  port: 9010
  upload_dir: "./tmp/uploads"

# Worker 配置
worker:
  concurrency: 2
  loglevel: "info"

# 回调配置
callback:
  timeout: 3  # （对齐接口定义）

# 任务配置
task:
  result_ttl: 3600  # Redis 中任务元数据 TTL（秒）

# Timer 计时器配置
timer:
  enabled: true                    # 全局开关，控制是否启用计时
  report_file: "timer_report.txt"  # 报告输出路径
  console_output: true             # 是否打印到控制台

# 图像下载配置（v2 新增）
image_download:
  timeout: 30                    # 下载超时时间（秒）
  max_size_mb: 50                # 最大文件大小（MB）
  allowed_extensions:            # 允许的图像格式
    - .jpg
    - .jpeg
    - .png
    - .dcm

# Pipeline/模型配置（v3.1 + v4 dental_age_stage）
pipelines:
  panoramic:
    preload: true                # Worker 启动时即初始化全景片 Pipeline
    modules:
      teeth_seg:
        description: "牙齿分割模块（YOLOv11实例分割）"
        weights_key: "weights/panoramic/1116_teeth_seg.pt"
        weights_force_download: false
        device: "0"
        conf: 0.25
        iou: 0.45

      teeth_attribute0:
        description: "牙齿属性1模块（YOLOv11）"
        weights_key: "weights/panoramic/model0.pt"
        weights_force_download: false
        device: "0"
        conf: 0.25
        iou: 0.45

      teeth_attribute1:
        description: "牙齿属性1模块（YOLOv11）"
        weights_key: "weights/panoramic/model1.pt"
        weights_force_download: false
        device: "0"
        conf: 0.25
        iou: 0.45

      teeth_attribute2:
        description: "牙齿属性2模块（YOLOv11）"
        weights_key: "weights/panoramic/model2.pt"
        weights_force_download: false
        device: "0"
        conf: 0.25
        iou: 0.45


      curved_short_root:
        description: "压根形态弯曲短小（YOLOv11）"
        weights_key: "weights/panoramic/model3.pt"
        weights_force_download: false
        device: "0"
        conf: 0.25
        iou: 0.45

      erupted_wisdomteeth:
        description: "智齿已萌出（YOLOv11）"
        weights_key: "weights/panoramic/model4.pt"
        weights_force_download: false
        device: "0"
        conf: 0.25
        iou: 0.45
      
      mandible_seg:
        description: "下颌骨分割模块（TransUNet ONNX）"
        weights_key: "weights/panoramic/transunet_mandible.onnx"
        weights_force_download: false
        input_size: [224, 224]
      
      implant_detect:
        description: "种植体检测模块（YOLOv11）"
        weights_key: "weights/panoramic/implant.pt"
        weights_force_download: false
        device: "0"
        conf: 0.25
        iou: 0.45
      
      condyle_seg:
        description: "髁突分割模块（ONNX）"
        weights_key: "weights/panoramic/candlye_seg.onnx"
        weights_force_download: false
        input_size: [224, 224]
      
      condyle_det:
        description: "髁突检测模块（YOLOv11）"
        weights_key: "weights/panoramic/candlye_detec_best.pt"
        weights_force_download: false
        device: "0"

      sinus_seg:
        description: "上颌窦结构分割模块（ResNetUNet ONNX）"
        weights_key: "weights/panoramic/sinus_structure_resnetunet.onnx"
        weights_force_download: false
        # 如果需要，可以加 input_size: [512, 512]

      sinus_class:
        description: "上颌窦炎症分类模块（ResNet18 ONNX）"
        weights_key: "weights/panoramic/sinus_inflam_classifier_resnet18.onnx"
        weights_force_download: false

      rootTipDensity_detect:
        description: "根尖低密度影检测模块（YOLOv11）"
        weights_key: "weights/panoramic/rootTipDensity_12_2.onnx"
        weights_force_download: false
        device: "0"
        conf: 0.25
        iou: 0.45

      periodontal_detect:
        description: "牙周吸收判断"
        weights_key: "weights/panoramic/periodontal.pt"
        weights_force_download: false
        device: "0"
        conf: 0.25
        iou: 0.45

  
  cephalometric:
    preload: true                # Worker 启动时即初始化侧位片 Pipeline
    modules:
      point:
        description: "标志点检测模型（25点）"
        weights_key: "weights/cephalometric/25point_best.pt"
        weights_force_download: false
        device: "0"
        image_size: 1024
        conf: 0.25
        iou: 0.6
        max_det: 1
      point_11:
        description: "气道/腺体标志点检测模型（11点）"
        weights_key: "weights/cephalometric/TODO_point_11.pt"  # TODO: 待填写实际权重路径
        weights_force_download: false
        device: "0"
        image_size: 1024
        conf: 0.25
        iou: 0.6
        max_det: 1
      cvm: 
        description: "颈椎成熟度"
        weights_key: "weights/cephalometric/CVM.pt"
        weights_force_download: false
        device: "0"
        conf: 0.25
  
  dental_age_stage:              # v4 新增：牙期检测
    preload: true                # Worker 启动时即初始化
    modules:
      teeth_seg:                 # 复用全景片的牙齿分割模块配置
        description: "牙齿分割模块（用于牙期检测）"
        weights_key: "weights/panoramic/1116_teeth_seg.pt"
        weights_force_download: false
        device: "0"
        conf: 0.25
        iou: 0.45

