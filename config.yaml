# 全局配置文件
# 支持环境变量覆盖：REDIS_HOST, REDIS_PORT, REDIS_DB, REDIS_PASSWORD

# Redis 配置
redis:
  host: "localhost"  # Docker: 使用 "redis"
  port: 6379
  db: 0
  password: null

# Celery 配置
celery:
  broker_url: "redis://localhost:6379/0"
  result_backend: "redis://localhost:6379/1"

# API 配置
api:
  host: "0.0.0.0"
  port: 18000
  upload_dir: "./tmp/uploads"

# Worker 配置
worker:
  concurrency: 2
  loglevel: "info"

# 回调配置
callback:
  timeout: 3  # （对齐接口定义）

# 任务配置
task:
  result_ttl: 3600  # Redis 中任务元数据 TTL（秒）

# 图像下载配置（v2 新增）
image_download:
  timeout: 30                    # 下载超时时间（秒）
  max_size_mb: 50                # 最大文件大小（MB）
  allowed_extensions:            # 允许的图像格式
    - .jpg
    - .jpeg
    - .png
    - .dcm

# Pipeline/模型配置（v3.1）
pipelines:
  panoramic:
    preload: true                # Worker 启动时即初始化全景片 Pipeline
    modules: {}                  # 全景片模块配置（暂无子模块）
  
  cephalometric:
    preload: true                # Worker 启动时即初始化侧位片 Pipeline
    modules:
      point:
        description: "标志点检测模型"
        weights_key: "weights/cephalometric/point_best_19.pt"
        weights_force_download: false
        device: "0"
        image_size: 1024
        conf: 0.25
        iou: 0.6
        max_det: 1
      # seg:  # 未实现的模块直接注释掉，而不是用 enabled: false
      #   description: "轮廓/结构分割模型（预留）"
      #   weights_key: "weights/cephalometric/seg/best.pt"
      #   weights_force_download: false
      #   device: "0"
      #   input_size: 1024
      #   conf: 0.35
      #   iou: 0.5
      #   classes: []

